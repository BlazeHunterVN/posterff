const nationData = {
    brazil: {
        images: [
            { url: 'https://dl.dir.freefiremobile.com/common/OB51/BR/Digimon_Squad_Treasure_1750x1070_BR_pt.png', startDate: '17/11/2025', bannerLink: 'https://dl.dir.freefiremobile.com/common/OB51/BR/Digimon_Squad_Treasure_1750x1070_BR_pt.png', title: '[REVENUE] Digimon Squad Treasure' },
            { url: 'https://dl.dir.freefiremobile.com/common/OB51/BR/SAMSUNG_1750x1070_BR_pt.jpg', startDate: '16/11/2025', bannerLink: 'https://shopee.com.br/m/samsung-e-freefire-na-shopee?utm_campaign=br_pd_social_youtube_a56_sustain_ac-2025GalaxyaH2-c-9mr5bq2878_video_skinFreefire-30s-na-na_awareness&utm_medium=diolv&utm_source=goads-9youtube&keeplink=true&cid=br_pd_social_youtube_a56_sustain_ac-2025GalaxyaH2-c-9mr5bq2878_video_skinFreefire-30s-na-na_awareness', title: '[BD] SAMSUNG' },
            { url: 'https://dl.dir.freefiremobile.com/common/OB51/BR/Fist_Bump_1750x1070_BR_pt.png', startDate: '15/11/2025', bannerLink: 'https://dl.dir.freefiremobile.com/common/OB51/BR/Fist_Bump_1750x1070_BR_pt.png', title: '[REVENUE] Fist Bump' },
        ]
    },
    india: {
        images: [
            { url: 'https://dl-tata.freefireind.in/common/Local/IND/config/1400x700_TheLatestUpdatesINDanno_en.jpg', startDate: '', bannerLink: 'https://www.instagram.com/freefireindiaofficial/', title: 'Official Instagram' },
            { url: 'https://dl-tata.freefireind.in/common/Local/IND/config/1400x700_StayInLoopAnnIND_en.jpg', startDate: '', bannerLink: 'https://www.facebook.com/freefireIND', title: 'Official Facebook' },
            { url: 'https://dl-tata.freefireind.in/common/Local/IND/config/1400x700_WatchTheBattleUnfoldINDAnno_en.jpg', startDate: '', bannerLink: 'https://www.youtube.com/@FreeFireIndiaOfficial', title: 'Official TikTok' }
        ]
    },
    indonesia: {
        images: [
            { url: 'https://dl.dir.freefiremobile.com/common/OB50/ID/annoOverview_sosmedcraftland.jpg', startDate: '', bannerLink: 'https://www.tiktok.com/@ffid.craftland?lang=en', title: 'Craftland TikTok' }
        ]
    },
    pakistan: {
        images: [
            { url: 'https://dl.dir.freefiremobile.com/common/Local/IND/config/1400x700_ig_en.jpg', startDate: '', bannerLink: 'https://www.instagram.com/freefirepkofficial/?hl=en', title: 'Official Instagram' },
            { url: 'https://dl.dir.freefiremobile.com/common/Local/IND/config/1400x700_enfb.jpg', startDate: '', bannerLink: 'https://www.facebook.com/freefireenn/?brand_redir=139274140865488#', title: 'Official Facebook' },
            { url: 'https://dl.dir.freefiremobile.com/common/Local/IND/config/1400x700_enyoutube.jpg', startDate: '', bannerLink: 'https://www.youtube.com/@FreeFirePakistanOfficial', title: 'Official YouTube' },
            { url: 'https://dl.dir.freefiremobile.com/common/Local/IND/config/1400x700_entiktok.jpg', startDate: '', bannerLink: 'https://www.tiktok.com/@garenafreefirepkofficial', title: 'Official TikTok' }
        ]
    },
    singapore: {
        images: [
            { url: 'https://dl.dir.freefiremobile.com/common/Local/IND/config/1400x700_ig_en.jpg', startDate: '', bannerLink: 'https://www.instagram.com/freefiremalaysiaofficial/', title: 'Official Instagram' },
            { url: 'https://dl.dir.freefiremobile.com/common/Local/IND/config/1400x700_enfb.jpg', startDate: '', bannerLink: 'https://www.facebook.com/freefiremalaysia/', title: 'Official Facebook' },
            { url: 'https://dl.dir.freefiremobile.com/common/Local/IND/config/1400x700_enyoutube.jpg', startDate: '', bannerLink: 'https://www.youtube.com/@freefiremalaysiaofficial', title: 'Official YouTube' },
            { url: 'https://dl.dir.freefiremobile.com/common/Local/IND/config/1400x700_entiktok.jpg', startDate: '', bannerLink: 'https://www.tiktok.com/@freefiremalaysiaofficial', title: 'Official TikTok' }
        ]
    },
    taiwan: {
        images: [
            
        ]
    },
    thailand: {
        images: [
            { url: 'https://dl.dir.freefiremobile.com/common/Local/TH/Splash/TH_Nov25_TW5_EA_DA_Bizon_Preheat1_Prime.png', startDate: '16/11/2025', bannerLink: 'https://dl.dir.freefiremobile.com/common/Local/TH/Splash/TH_Nov25_TW4_DA_M590_Preheat1.png', title: 'Bizon Preheat' },
            { url: 'https://dl.dir.freefiremobile.com/common/Local/TH/Splash/TH_Nov25_TW4_DA_M590_Preheat2.png', startDate: '16/11/2025', bannerLink: 'https://dl.dir.freefiremobile.com/common/Local/TH/Splash/TH_Nov25_TW4_DA_M590_Preheat2.png', title: 'TW4 DA M590 Preheat2' },
            { url: 'https://dl.dir.freefiremobile.com/common/Local/TH/Splash/TH_Nov25_TW4_DA_M590_Preheat1.png', startDate: '15/11/2025', bannerLink: 'https://dl.dir.freefiremobile.com/common/Local/TH/Splash/TH_Nov25_TW4_DA_M590_Preheat1.png', title: 'TW4 DA M590 Preheat1' },
            { url: 'https://dl.dir.freefiremobile.com/common/Local/TH/Splash/TH_Nov25_TW3_UnisexBundle_FFWS.png', startDate: '15/11/2025', bannerLink: 'https://dl.dir.freefiremobile.com/common/Local/TH/Splash/TH_Nov25_TW3_UnisexBundle_FFWS.png', title: 'FFWS Unisex Bundle' },
            { url: 'https://dl.dir.freefiremobile.com/common/Local/TH/Splash/TH_Nov25_TW1_EvoVault.png', startDate: '14/11/2025', bannerLink: 'https://dl.dir.freefiremobile.com/common/Local/TH/Splash/TH_Nov25_TW1_EvoVault.png', title: 'TW1 EvoVault' },
            { url: 'https://dl.dir.freefiremobile.com/common/Local/TH/Splash/2025Nov_FA_DIGI_FlexHigh_Playwithfriends_games_Multimission_2.png', startDate: '14/11/2025', bannerLink: 'https://dl.dir.freefiremobile.com/common/Local/TH/Splash/2025Nov_FA_DIGI_FlexHigh_Playwithfriends_games_Multimission_2.png', title: 'Play with Friends' }
        ]
    },
    vietnam: {
        images: [
            { url: 'https://dl.dir.freefiremobile.com/common/Local/VN/Splash_Upload/251117_OB47VN_Squad_Treasure_Digimon.png', startDate: '17/11/2025', bannerLink: 'https://dl.dir.freefiremobile.com/common/Local/VN/Splash_Upload/251117_OB47VN_Squad_Treasure_Digimon.png', title: 'Squad Treasure Digimon' },
            { url: 'https://dl.dir.freefiremobile.com/common/Local/VN/Splash_Upload/251117_OB47VN_TW3_M590_MetalGarurumon.png', startDate: '17/11/2025', bannerLink: 'https://dl.dir.freefiremobile.com/common/Local/VN/Splash_Upload/251117_OB47VN_TW3_M590_MetalGarurumon.png', title: 'TW3 M590 MetalGarurumon' },
            { url: 'https://dl.dir.freefiremobile.com/common/Local/VN/Splash_Upload/251116_OB47VN_FW3_Naatu_Naatu.png', startDate: '16/11/2025', bannerLink: 'https://dl.dir.freefiremobile.com/common/Local/VN/Splash_Upload/251116_OB47VN_FW3_Naatu_Naatu.png', title: 'FW3 Naatu Naatu' },
            { url: 'https://dl.dir.freefiremobile.com/common/Local/VN/Splash_Upload/251114_OB47VN_TW1_Will_of_Fire_Bundle.png', startDate: '14/11/2025', bannerLink: 'https://dl.dir.freefiremobile.com/common/Local/VN/Splash_Upload/251114_OB47VN_TW1_Will_of_Fire_Bundle.png', title: 'TW1 Will Of Fire Bundle' },
        ]
    }
};

const menuToggle = document.querySelector('.menu-toggle');
const navbar = document.querySelector('.navbar');
const homeSection = document.getElementById('home-section');
const nationSection = document.getElementById('nation-section');
const nationHeading = document.getElementById('nation-heading');
const imageGrid = document.getElementById('image-grid');
const contactSection = document.getElementById('contact-section');
const logoLink = document.querySelector('.logo a');

const gridOverlay = document.getElementById('grid-overlay');
const overlayTitle = document.getElementById('overlay-title');
const overlayDate = document.getElementById('overlay-date');
const overlayLink = document.getElementById('overlay-link');
const closeBtn = document.querySelector('.close-btn');
const overlayImage = document.getElementById('overlay-image');

const nationDropdownLi = document.querySelector('.dropdown');
const nationDropdownLink = nationDropdownLi ? nationDropdownLi.querySelector('.nav-link') : null;

const homeBackgrounds = [
    '/common/image/background_free_fire_55.png',
    '/common/image/background_free_fire_56.png',
];
let currentBgIndex = 0;
let slideshowInterval;
const layer1 = document.getElementById('background-layer-1');
const layer2 = document.getElementById('background-layer-2');
const homeHeading = document.getElementById('home-heading-1');
const homeParagraph = document.getElementById('home-paragraph-1');

let activeLayer = layer1;
let nextLayer = layer2;

function showSection(section) {
    const allSections = document.querySelectorAll('.content-section');
    allSections.forEach(s => s.classList.remove('active'));
    section.classList.add('active');

    if (section !== homeSection) {
        clearInterval(slideshowInterval);
    }
}

const navLinks = document.querySelectorAll('.nav-links a');

navLinks.forEach(link => {
    link.addEventListener('click', (e) => {
        e.preventDefault();

        const path = e.target.getAttribute('href');
        const parts = path.split('/');
        const country = parts[parts.length - 1];

        const parentLi = e.target.closest('li');
        const isNationLink = (parentLi && parentLi.classList.contains('dropdown'));
        const isCountryLink = (parentLi && parentLi.closest('.dropdown-menu'));

        if (window.innerWidth <= 768) {
            if (isNationLink && !isCountryLink) {
                if (nationDropdownLi) {
                    nationDropdownLi.classList.toggle('active');
                }
                if (path === '/nation') {
                    handleRouting(path, country);
                }
                return;
            }

            if (isCountryLink || path === '/' || path === '/contact') {
                navbar.classList.remove('active');
                if (nationDropdownLi) {
                    nationDropdownLi.classList.remove('active');
                }
                const menuIcon = menuToggle.querySelector('i');
                menuIcon.classList.remove('fa-times');
                menuIcon.classList.add('fa-bars');
            }
        }

        handleRouting(path, country);

        setTimeout(initializeHomeAnimation, 50);
    });
});


logoLink.addEventListener('click', (e) => {
    e.preventDefault();
    handleRouting('/');
    setTimeout(initializeHomeAnimation, 50);
});

function handleRouting(path, country) {
    if (path === '/') {
        showSection(homeSection);
        nationHeading.textContent = '';
    } else if (path.startsWith('/nation/')) {
        showSection(nationSection);
        nationHeading.textContent = country.charAt(0).toUpperCase() + country.slice(1);
        displayImages(country);
    } else if (path === '/nation') {
        showSection(nationSection);
        nationHeading.textContent = 'Nation';
        displayImages('default');
    } else if (path === '/contact') {
        showSection(contactSection);
        nationHeading.textContent = 'Contact';
    } else {
        showSection(homeSection);
    }

    window.history.pushState({}, '', path);
}

window.addEventListener('popstate', () => {
    const currentPath = window.location.pathname;
    const parts = currentPath.split('/');
    const country = parts[parts.length - 1];

    handleRouting(currentPath, country);
});

document.addEventListener('DOMContentLoaded', () => {
    const currentPath = window.location.pathname;
    const parts = currentPath.split('/');
    const country = parts[parts.length - 1];

    handleRouting(currentPath, country);
    setTimeout(initializeHomeAnimation, 100);
});

menuToggle.addEventListener('click', () => {
    navbar.classList.toggle('active');
    const menuIcon = menuToggle.querySelector('i');

    if (navbar.classList.contains('active')) {
        menuIcon.classList.remove('fa-bars');
        menuIcon.classList.add('fa-times');
    } else {
        menuIcon.classList.remove('fa-times');
        menuIcon.classList.add('fa-bars');
        if (nationDropdownLi && nationDropdownLi.classList.contains('active')) {
            nationDropdownLi.classList.remove('active');
        }
    }
});

function getEventStatus(startDateString) {
    if (!startDateString) {
        return { status: 'none', label: '' };
    }

    const [day, month, year] = startDateString.split('/').map(Number);
    const startDate = new Date(year, month - 1, day);
    const now = new Date();
    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
    const eventDay = new Date(startDate.getFullYear(), startDate.getMonth(), startDate.getDate());

    if (eventDay <= today) {
        return { status: 'active', label: 'ACTIVE' };
    } else {
        return { status: 'upcoming', label: 'UPCOMING' };
    }
}

function displayImages(country) {
    imageGrid.innerHTML = '';
    const data = nationData[country];
    const images = data && data.images ? data.images : [];

    if (images.length === 0 || country === 'default') {
        imageGrid.innerHTML = `<div style="text-align: center; width: 100%; padding: 50px; color: #aaa;">
                                 <h1>Please select a country from the Nation menu.</h1>
                                 <p>Or, this nation is currently updating its banner data.</p>
                                </div>`;
        return;
    }

    images.forEach((imageData, index) => {
        const gridItem = document.createElement('div');
        gridItem.classList.add('grid-item');
        gridItem.dataset.country = country;
        gridItem.dataset.index = index;

        const { status, label } = getEventStatus(imageData.startDate);

        if (status !== 'none') {
            const badgeElement = document.createElement('div');
            badgeElement.classList.add('event-badge', `${status}-event`);
            badgeElement.textContent = label;
            badgeElement.style.display = 'block';
            gridItem.appendChild(badgeElement);
        }

        const imgElement = document.createElement('img');
        imgElement.src = imageData.url;
        imgElement.alt = `${country} image`;

        const titleElement = document.createElement('p');
        titleElement.classList.add('grid-item-title');
        titleElement.textContent = imageData.title || 'No Title';

        const tempImage = new Image();

        tempImage.onload = () => {
            gridItem.appendChild(imgElement);
            gridItem.appendChild(titleElement);
            imageGrid.appendChild(gridItem);
        };

        tempImage.onerror = () => {
            const updatingDiv = document.createElement('div');
            updatingDiv.textContent = 'Updating...';
            updatingDiv.classList.add('updating-message');

            gridItem.appendChild(updatingDiv);
            gridItem.appendChild(titleElement);
            imageGrid.appendChild(gridItem);
        };

        if (imageData.url) {
            tempImage.src = imageData.url;
        } else {
            tempImage.onerror();
        }
    });
}

imageGrid.addEventListener('click', (e) => {
    const target = e.target.closest('.grid-item');
    if (!target) return;

    const country = target.dataset.country;
    const index = target.dataset.index;

    const countryData = nationData[country];
    let data = null;
    if (!countryData || !countryData.images[index]) return;

    data = countryData.images[index];

    if (target.querySelector('.updating-message')) {
        overlayImage.style.display = 'none';
    } else {
        overlayImage.style.display = 'block';
        overlayImage.src = data.url;
    }

    if (data) {
        overlayTitle.textContent = data.title || 'Detailed Information';
        overlayDate.textContent = `Start Date: ${data.startDate || 'N/A'}`;
        overlayLink.textContent = `Link Banner`;
        overlayLink.href = data.bannerLink || '#';
        gridOverlay.style.display = 'flex';
    }
});

closeBtn.addEventListener('click', () => {
    gridOverlay.style.display = 'none';
});


function splitTextElements() {
    const elements = document.querySelectorAll('.split-text');
    elements.forEach(el => {
        if (el.textContent && !el.querySelector('span')) {
            const text = el.textContent.trim();
            el.innerHTML = text.split('').map(char => {
                return char === ' ' ? '<span> </span>' : `<span>${char}</span>`;
            }).join('');
        }
    });
}

function animateSplitText(element) {
    if (!element) return;
    const spans = element.querySelectorAll('span');
    spans.forEach((span, index) => {
        setTimeout(() => {
            span.style.opacity = 1;
            span.style.transform = 'translateY(0)';
        }, index * 30);
    });
}

function initializeHomeAnimation() {
    splitTextElements();

    if (homeSection && homeSection.classList.contains('active')) {
        if (homeHeading && homeParagraph) {
            const resetSpans = (element) => {
                element.querySelectorAll('span').forEach(s => {
                    s.style.opacity = 0;
                    s.style.transform = 'translateY(20px)';
                    s.style.transition = 'none';
                });
            };
            resetSpans(homeHeading);
            resetSpans(homeParagraph);

            setTimeout(() => {
                const enableTransition = (element) => {
                    element.querySelectorAll('span').forEach(s => {
                        s.style.transition = 'opacity 0.3s ease-out, transform 0.3s ease-out';
                    });
                };
                enableTransition(homeHeading);
                enableTransition(homeParagraph);
            }, 50);

            animateSplitText(homeHeading);

            const delay = homeHeading.textContent ? homeHeading.textContent.length * 30 + 100 : 500;

            setTimeout(() => {
                animateSplitText(homeParagraph);
            }, delay);
        }
    }
}

function preloadImages(imageUrls) {
    const promises = imageUrls.map(url => {
        return new Promise((resolve) => {
            const img = new Image();
            img.onload = resolve;
            img.onerror = resolve;
            img.src = url;
        });
    });
    return Promise.all(promises);
}

function changeBackground() {
    const totalImages = homeBackgrounds.length;
    if (totalImages < 2) return;

    currentBgIndex = (currentBgIndex + 1) % totalImages;

    const nextNextBgIndex = (currentBgIndex + 1) % totalImages;

    activeLayer.classList.remove('active');

    [activeLayer, nextLayer] = [nextLayer, activeLayer];

    activeLayer.classList.add('active');

    setTimeout(() => {
        nextLayer.style.backgroundImage = `url('${homeBackgrounds[nextNextBgIndex]}')`;
    }, 2000);
}


function startBackgroundSlideshow() {
    const totalImages = homeBackgrounds.length;
    if (!homeSection || totalImages === 0) return;

    if (slideshowInterval) {
        clearInterval(slideshowInterval);
    }

    preloadImages(homeBackgrounds)
        .then(() => {
            if (totalImages === 1) {
                layer1.style.backgroundImage = `url('${homeBackgrounds[0]}')`;
                layer1.classList.add('active');
                layer2.classList.remove('active');
                return;
            }

            layer1.style.backgroundImage = `url('${homeBackgrounds[0]}')`;
            layer1.classList.add('active');

            const nextIndex = (currentBgIndex + 1) % totalImages;
            layer2.style.backgroundImage = `url('${homeBackgrounds[nextIndex]}')`;
            layer2.classList.remove('active');

            activeLayer = layer1;
            nextLayer = layer2;
            currentBgIndex = 0;

            slideshowInterval = setInterval(changeBackground, 5000);
        });
}

if (homeSection && homeSection.classList.contains('active')) {
    startBackgroundSlideshow();

}
